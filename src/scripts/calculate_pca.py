# coding=utf-8

import numpy as np
import os

from keras.preprocessing.image import load_img, img_to_array


def calculate_pca(np_image_data):
    """
    Calculates the PCA values for the different channels in the image data.

    :param np_image_data: numpy tensor of image data in format NxHxWxCHANNELS
    :return:
    """

    np_image_data_flattened = np_image_data.reshape(-1, np_image_data.shape[-1])

    # Normalize data to range [-1, 1]
    np_image_data_flattened -= 128.0
    np_image_data_flattened /= 128.0

    # Calculate the covariance matrix
    # Note: cov will take care of mean centering of the data
    cov = np.cov(np_image_data_flattened.T)
    eigvals, eigvects = np.linalg.eigh(cov)
    pca = np.sqrt(eigvals) * eigvects

    print 'Eigen values:\n{}'.format(eigvals)
    print 'Eigen vectors:\n{}'.format(eigvects)
    print 'PCA:\n{}'.format(pca)

    return pca


if __name__ == '__main__':
    PATH = '../../data/IVRG/Indoor_dataset/rgbImages'
    IMAGES = [(u'img_138_vis.JPG', u'img_138_vis.png'), (u'img_398_vis.JPG', u'img_398_vis.png'), (u'img_192_vis.JPG', u'img_192_vis.png'), (u'img_139_vis.JPG', u'img_139_vis.png'), (u'img_221_vis.JPG', u'img_221_vis.png'), (u'img_081_vis.JPG', u'img_081_vis.png'), (u'img_028_vis.JPG', u'img_028_vis.png'), (u'img_399_vis.JPG', u'img_399_vis.png'), (u'img_156_vis.JPG', u'img_156_vis.png'), (u'img_015_vis.JPG', u'img_015_vis.png'), (u'img_077_vis.JPG', u'img_077_vis.png'), (u'img_374_vis.JPG', u'img_374_vis.png'), (u'img_356_vis.JPG', u'img_356_vis.png'), (u'img_027_vis.JPG', u'img_027_vis.png'), (u'img_149_vis.JPG', u'img_149_vis.png'), (u'img_212_vis.JPG', u'img_212_vis.png'), (u'img_267_vis.JPG', u'img_267_vis.png'), (u'img_304_vis.JPG', u'img_304_vis.png'), (u'img_282_vis.JPG', u'img_282_vis.png'), (u'img_078_vis.JPG', u'img_078_vis.png'), (u'img_218_vis.JPG', u'img_218_vis.png'), (u'img_126_vis.JPG', u'img_126_vis.png'), (u'img_062_vis.JPG', u'img_062_vis.png'), (u'img_143_vis.JPG', u'img_143_vis.png'), (u'img_297_vis.JPG', u'img_297_vis.png'), (u'img_116_vis.JPG', u'img_116_vis.png'), (u'img_158_vis.JPG', u'img_158_vis.png'), (u'img_131_vis.JPG', u'img_131_vis.png'), (u'img_193_vis.JPG', u'img_193_vis.png'), (u'img_349_vis.JPG', u'img_349_vis.png'), (u'img_204_vis.JPG', u'img_204_vis.png'), (u'img_194_vis.JPG', u'img_194_vis.png'), (u'img_014_vis.JPG', u'img_014_vis.png'), (u'img_160_vis.JPG', u'img_160_vis.png'), (u'img_382_vis.JPG', u'img_382_vis.png'), (u'img_385_vis.JPG', u'img_385_vis.png'), (u'img_375_vis.JPG', u'img_375_vis.png'), (u'img_232_vis.JPG', u'img_232_vis.png'), (u'img_155_vis.JPG', u'img_155_vis.png'), (u'img_330_vis.JPG', u'img_330_vis.png'), (u'img_164_vis.JPG', u'img_164_vis.png'), (u'img_332_vis.JPG', u'img_332_vis.png'), (u'img_262_vis.JPG', u'img_262_vis.png'), (u'img_083_vis.JPG', u'img_083_vis.png'), (u'img_042_vis.JPG', u'img_042_vis.png'), (u'img_325_vis.JPG', u'img_325_vis.png'), (u'img_309_vis.JPG', u'img_309_vis.png'), (u'img_167_vis.JPG', u'img_167_vis.png'), (u'img_132_vis.JPG', u'img_132_vis.png'), (u'img_190_vis.JPG', u'img_190_vis.png'), (u'img_202_vis.JPG', u'img_202_vis.png'), (u'img_239_vis.JPG', u'img_239_vis.png'), (u'img_075_vis.JPG', u'img_075_vis.png'), (u'img_345_vis.JPG', u'img_345_vis.png'), (u'img_120_vis.JPG', u'img_120_vis.png'), (u'img_199_vis.JPG', u'img_199_vis.png'), (u'img_219_vis.JPG', u'img_219_vis.png'), (u'img_071_vis.JPG', u'img_071_vis.png'), (u'img_371_vis.JPG', u'img_371_vis.png'), (u'img_169_vis.JPG', u'img_169_vis.png'), (u'img_007_vis.JPG', u'img_007_vis.png'), (u'img_333_vis.JPG', u'img_333_vis.png'), (u'img_208_vis.JPG', u'img_208_vis.png'), (u'img_328_vis.JPG', u'img_328_vis.png'), (u'img_163_vis.JPG', u'img_163_vis.png'), (u'img_034_vis.JPG', u'img_034_vis.png'), (u'img_162_vis.JPG', u'img_162_vis.png'), (u'img_166_vis.JPG', u'img_166_vis.png'), (u'img_255_vis.JPG', u'img_255_vis.png'), (u'img_125_vis.JPG', u'img_125_vis.png'), (u'img_235_vis.JPG', u'img_235_vis.png'), (u'img_055_vis.JPG', u'img_055_vis.png'), (u'img_200_vis.JPG', u'img_200_vis.png'), (u'img_095_vis.JPG', u'img_095_vis.png'), (u'img_109_vis.JPG', u'img_109_vis.png'), (u'img_124_vis.JPG', u'img_124_vis.png'), (u'img_231_vis.JPG', u'img_231_vis.png'), (u'img_257_vis.JPG', u'img_257_vis.png'), (u'img_315_vis.JPG', u'img_315_vis.png'), (u'img_197_vis.JPG', u'img_197_vis.png'), (u'img_038_vis.JPG', u'img_038_vis.png'), (u'img_223_vis.JPG', u'img_223_vis.png'), (u'img_097_vis.JPG', u'img_097_vis.png'), (u'img_137_vis.JPG', u'img_137_vis.png'), (u'img_350_vis.JPG', u'img_350_vis.png'), (u'img_054_vis.JPG', u'img_054_vis.png'), (u'img_174_vis.JPG', u'img_174_vis.png'), (u'img_191_vis.JPG', u'img_191_vis.png'), (u'img_104_vis.JPG', u'img_104_vis.png'), (u'img_024_vis.JPG', u'img_024_vis.png'), (u'img_195_vis.JPG', u'img_195_vis.png'), (u'img_106_vis.JPG', u'img_106_vis.png'), (u'img_072_vis.JPG', u'img_072_vis.png'), (u'img_214_vis.JPG', u'img_214_vis.png'), (u'img_394_vis.JPG', u'img_394_vis.png'), (u'img_145_vis.JPG', u'img_145_vis.png'), (u'img_148_vis.JPG', u'img_148_vis.png'), (u'img_006_vis.JPG', u'img_006_vis.png'), (u'img_207_vis.JPG', u'img_207_vis.png'), (u'img_323_vis.JPG', u'img_323_vis.png'), (u'img_018_vis.JPG', u'img_018_vis.png'), (u'img_280_vis.JPG', u'img_280_vis.png'), (u'img_115_vis.JPG', u'img_115_vis.png'), (u'img_253_vis.JPG', u'img_253_vis.png'), (u'img_161_vis.JPG', u'img_161_vis.png'), (u'img_022_vis.JPG', u'img_022_vis.png'), (u'img_230_vis.JPG', u'img_230_vis.png'), (u'img_254_vis.JPG', u'img_254_vis.png'), (u'img_121_vis.JPG', u'img_121_vis.png'), (u'img_210_vis.JPG', u'img_210_vis.png'), (u'img_285_vis.JPG', u'img_285_vis.png'), (u'img_111_vis.JPG', u'img_111_vis.png'), (u'img_159_vis.JPG', u'img_159_vis.png'), (u'img_141_vis.JPG', u'img_141_vis.png'), (u'img_037_vis.JPG', u'img_037_vis.png'), (u'img_101_vis.JPG', u'img_101_vis.png'), (u'img_366_vis.JPG', u'img_366_vis.png'), (u'img_084_vis.JPG', u'img_084_vis.png'), (u'img_063_vis.JPG', u'img_063_vis.png'), (u'img_217_vis.JPG', u'img_217_vis.png'), (u'img_090_vis.JPG', u'img_090_vis.png'), (u'img_248_vis.JPG', u'img_248_vis.png'), (u'img_352_vis.JPG', u'img_352_vis.png'), (u'img_358_vis.JPG', u'img_358_vis.png'), (u'img_387_vis.JPG', u'img_387_vis.png'), (u'img_082_vis.JPG', u'img_082_vis.png'), (u'img_362_vis.JPG', u'img_362_vis.png'), (u'img_129_vis.JPG', u'img_129_vis.png'), (u'img_185_vis.JPG', u'img_185_vis.png'), (u'img_386_vis.JPG', u'img_386_vis.png'), (u'img_364_vis.JPG', u'img_364_vis.png'), (u'img_252_vis.JPG', u'img_252_vis.png'), (u'img_113_vis.JPG', u'img_113_vis.png'), (u'img_033_vis.JPG', u'img_033_vis.png'), (u'img_122_vis.JPG', u'img_122_vis.png'), (u'img_114_vis.JPG', u'img_114_vis.png'), (u'img_306_vis.JPG', u'img_306_vis.png'), (u'img_391_vis.JPG', u'img_391_vis.png'), (u'img_201_vis.JPG', u'img_201_vis.png'), (u'img_263_vis.JPG', u'img_263_vis.png'), (u'img_046_vis.JPG', u'img_046_vis.png'), (u'img_397_vis.JPG', u'img_397_vis.png'), (u'img_030_vis.JPG', u'img_030_vis.png'), (u'img_281_vis.JPG', u'img_281_vis.png'), (u'img_388_vis.JPG', u'img_388_vis.png'), (u'img_165_vis.JPG', u'img_165_vis.png'), (u'img_010_vis.JPG', u'img_010_vis.png'), (u'img_085_vis.JPG', u'img_085_vis.png'), (u'img_058_vis.JPG', u'img_058_vis.png'), (u'img_103_vis.JPG', u'img_103_vis.png'), (u'img_228_vis.JPG', u'img_228_vis.png'), (u'img_091_vis.JPG', u'img_091_vis.png'), (u'img_175_vis.JPG', u'img_175_vis.png'), (u'img_183_vis.JPG', u'img_183_vis.png'), (u'img_308_vis.JPG', u'img_308_vis.png'), (u'img_061_vis.JPG', u'img_061_vis.png'), (u'img_372_vis.JPG', u'img_372_vis.png'), (u'img_277_vis.JPG', u'img_277_vis.png'), (u'img_314_vis.JPG', u'img_314_vis.png'), (u'img_220_vis.JPG', u'img_220_vis.png'), (u'img_335_vis.JPG', u'img_335_vis.png'), (u'img_343_vis.JPG', u'img_343_vis.png'), (u'img_295_vis.JPG', u'img_295_vis.png'), (u'img_073_vis.JPG', u'img_073_vis.png'), (u'img_087_vis.JPG', u'img_087_vis.png'), (u'img_286_vis.JPG', u'img_286_vis.png'), (u'img_389_vis.JPG', u'img_389_vis.png'), (u'img_344_vis.JPG', u'img_344_vis.png'), (u'img_147_vis.JPG', u'img_147_vis.png'), (u'img_180_vis.JPG', u'img_180_vis.png'), (u'img_196_vis.JPG', u'img_196_vis.png'), (u'img_320_vis.JPG', u'img_320_vis.png'), (u'img_384_vis.JPG', u'img_384_vis.png'), (u'img_348_vis.JPG', u'img_348_vis.png'), (u'img_396_vis.JPG', u'img_396_vis.png'), (u'img_283_vis.JPG', u'img_283_vis.png'), (u'img_377_vis.JPG', u'img_377_vis.png'), (u'img_316_vis.JPG', u'img_316_vis.png'), (u'img_294_vis.JPG', u'img_294_vis.png'), (u'img_107_vis.JPG', u'img_107_vis.png'), (u'img_089_vis.JPG', u'img_089_vis.png'), (u'img_094_vis.JPG', u'img_094_vis.png'), (u'img_321_vis.JPG', u'img_321_vis.png'), (u'img_279_vis.JPG', u'img_279_vis.png'), (u'img_036_vis.JPG', u'img_036_vis.png'), (u'img_392_vis.JPG', u'img_392_vis.png'), (u'img_130_vis.JPG', u'img_130_vis.png'), (u'img_043_vis.JPG', u'img_043_vis.png'), (u'img_119_vis.JPG', u'img_119_vis.png'), (u'img_236_vis.JPG', u'img_236_vis.png'), (u'img_206_vis.JPG', u'img_206_vis.png'), (u'img_004_vis.JPG', u'img_004_vis.png'), (u'img_379_vis.JPG', u'img_379_vis.png'), (u'img_395_vis.JPG', u'img_395_vis.png'), (u'img_381_vis.JPG', u'img_381_vis.png'), (u'img_237_vis.JPG', u'img_237_vis.png'), (u'img_133_vis.JPG', u'img_133_vis.png'), (u'img_016_vis.JPG', u'img_016_vis.png'), (u'img_224_vis.JPG', u'img_224_vis.png'), (u'img_287_vis.JPG', u'img_287_vis.png'), (u'img_152_vis.JPG', u'img_152_vis.png'), (u'img_025_vis.JPG', u'img_025_vis.png'), (u'img_056_vis.JPG', u'img_056_vis.png'), (u'img_044_vis.JPG', u'img_044_vis.png'), (u'img_327_vis.JPG', u'img_327_vis.png'), (u'img_270_vis.JPG', u'img_270_vis.png'), (u'img_170_vis.JPG', u'img_170_vis.png'), (u'img_172_vis.JPG', u'img_172_vis.png'), (u'img_222_vis.JPG', u'img_222_vis.png'), (u'img_380_vis.JPG', u'img_380_vis.png'), (u'img_336_vis.JPG', u'img_336_vis.png'), (u'img_346_vis.JPG', u'img_346_vis.png'), (u'img_001_vis.JPG', u'img_001_vis.png'), (u'img_128_vis.JPG', u'img_128_vis.png'), (u'img_093_vis.JPG', u'img_093_vis.png'), (u'img_059_vis.JPG', u'img_059_vis.png'), (u'img_259_vis.JPG', u'img_259_vis.png'), (u'img_369_vis.JPG', u'img_369_vis.png'), (u'img_234_vis.JPG', u'img_234_vis.png'), (u'img_176_vis.JPG', u'img_176_vis.png'), (u'img_310_vis.JPG', u'img_310_vis.png'), (u'img_278_vis.JPG', u'img_278_vis.png'), (u'img_052_vis.JPG', u'img_052_vis.png'), (u'img_368_vis.JPG', u'img_368_vis.png'), (u'img_264_vis.JPG', u'img_264_vis.png'), (u'img_256_vis.JPG', u'img_256_vis.png'), (u'img_341_vis.JPG', u'img_341_vis.png'), (u'img_272_vis.JPG', u'img_272_vis.png'), (u'img_291_vis.JPG', u'img_291_vis.png'), (u'img_123_vis.JPG', u'img_123_vis.png'), (u'img_118_vis.JPG', u'img_118_vis.png'), (u'img_376_vis.JPG', u'img_376_vis.png'), (u'img_134_vis.JPG', u'img_134_vis.png'), (u'img_050_vis.JPG', u'img_050_vis.png'), (u'img_247_vis.JPG', u'img_247_vis.png'), (u'img_299_vis.JPG', u'img_299_vis.png'), (u'img_233_vis.JPG', u'img_233_vis.png'), (u'img_013_vis.JPG', u'img_013_vis.png'), (u'img_112_vis.JPG', u'img_112_vis.png'), (u'img_002_vis.JPG', u'img_002_vis.png'), (u'img_178_vis.JPG', u'img_178_vis.png'), (u'img_266_vis.JPG', u'img_266_vis.png'), (u'img_065_vis.JPG', u'img_065_vis.png'), (u'img_205_vis.JPG', u'img_205_vis.png'), (u'img_276_vis.JPG', u'img_276_vis.png'), (u'img_244_vis.JPG', u'img_244_vis.png'), (u'img_216_vis.JPG', u'img_216_vis.png'), (u'img_288_vis.JPG', u'img_288_vis.png'), (u'img_117_vis.JPG', u'img_117_vis.png'), (u'img_293_vis.JPG', u'img_293_vis.png'), (u'img_181_vis.JPG', u'img_181_vis.png'), (u'img_189_vis.JPG', u'img_189_vis.png'), (u'img_305_vis.JPG', u'img_305_vis.png'), (u'img_393_vis.JPG', u'img_393_vis.png'), (u'img_026_vis.JPG', u'img_026_vis.png'), (u'img_209_vis.JPG', u'img_209_vis.png'), (u'img_142_vis.JPG', u'img_142_vis.png'), (u'img_240_vis.JPG', u'img_240_vis.png'), (u'img_051_vis.JPG', u'img_051_vis.png'), (u'img_173_vis.JPG', u'img_173_vis.png'), (u'img_079_vis.JPG', u'img_079_vis.png'), (u'img_198_vis.JPG', u'img_198_vis.png'), (u'img_359_vis.JPG', u'img_359_vis.png'), (u'img_326_vis.JPG', u'img_326_vis.png'), (u'img_032_vis.JPG', u'img_032_vis.png'), (u'img_337_vis.JPG', u'img_337_vis.png'), (u'img_074_vis.JPG', u'img_074_vis.png'), (u'img_186_vis.JPG', u'img_186_vis.png'), (u'img_238_vis.JPG', u'img_238_vis.png'), (u'img_060_vis.JPG', u'img_060_vis.png'), (u'img_184_vis.JPG', u'img_184_vis.png'), (u'img_146_vis.JPG', u'img_146_vis.png'), (u'img_242_vis.JPG', u'img_242_vis.png'), (u'img_012_vis.JPG', u'img_012_vis.png'), (u'img_108_vis.JPG', u'img_108_vis.png'), (u'img_008_vis.JPG', u'img_008_vis.png'), (u'img_357_vis.JPG', u'img_357_vis.png'), (u'img_303_vis.JPG', u'img_303_vis.png'), (u'img_068_vis.JPG', u'img_068_vis.png'), (u'img_135_vis.JPG', u'img_135_vis.png'), (u'img_070_vis.JPG', u'img_070_vis.png'), (u'img_098_vis.JPG', u'img_098_vis.png'), (u'img_168_vis.JPG', u'img_168_vis.png'), (u'img_318_vis.JPG', u'img_318_vis.png'), (u'img_268_vis.JPG', u'img_268_vis.png'), (u'img_076_vis.JPG', u'img_076_vis.png'), (u'img_069_vis.JPG', u'img_069_vis.png'), (u'img_088_vis.JPG', u'img_088_vis.png'), (u'img_363_vis.JPG', u'img_363_vis.png'), (u'img_179_vis.JPG', u'img_179_vis.png'), (u'img_324_vis.JPG', u'img_324_vis.png'), (u'img_211_vis.JPG', u'img_211_vis.png'), (u'img_260_vis.JPG', u'img_260_vis.png'), (u'img_251_vis.JPG', u'img_251_vis.png'), (u'img_258_vis.JPG', u'img_258_vis.png'), (u'img_227_vis.JPG', u'img_227_vis.png'), (u'img_154_vis.JPG', u'img_154_vis.png'), (u'img_100_vis.JPG', u'img_100_vis.png'), (u'img_296_vis.JPG', u'img_296_vis.png'), (u'img_177_vis.JPG', u'img_177_vis.png'), (u'img_367_vis.JPG', u'img_367_vis.png'), (u'img_261_vis.JPG', u'img_261_vis.png'), (u'img_048_vis.JPG', u'img_048_vis.png'), (u'img_105_vis.JPG', u'img_105_vis.png'), (u'img_373_vis.JPG', u'img_373_vis.png'), (u'img_049_vis.JPG', u'img_049_vis.png'), (u'img_153_vis.JPG', u'img_153_vis.png'), (u'img_300_vis.JPG', u'img_300_vis.png'), (u'img_187_vis.JPG', u'img_187_vis.png'), (u'img_171_vis.JPG', u'img_171_vis.png'), (u'img_021_vis.JPG', u'img_021_vis.png'), (u'img_331_vis.JPG', u'img_331_vis.png'), (u'img_102_vis.JPG', u'img_102_vis.png'), (u'img_140_vis.JPG', u'img_140_vis.png'), (u'img_057_vis.JPG', u'img_057_vis.png'), (u'img_245_vis.JPG', u'img_245_vis.png'), (u'img_319_vis.JPG', u'img_319_vis.png'), (u'img_003_vis.JPG', u'img_003_vis.png'), (u'img_127_vis.JPG', u'img_127_vis.png'), (u'img_182_vis.JPG', u'img_182_vis.png')]
    IMAGES = [img[0] for img in IMAGES]
    num_images = len(IMAGES)

    print 'Reading {} images from {}'.format(num_images, PATH)
    image_data = []

    for idx, img in enumerate(IMAGES):
        image = load_img(os.path.join(PATH, img))
        np_image_data = img_to_array(image)
        image_data.append(np_image_data)

        if idx%10 == 0:
            print 'Read {}/{} images'.format(idx+1, num_images)

    print 'All images read successfully'
    image_data = np.array(num_images)

    print 'Calculating PCA from the data'

    pca = calculate_pca()

    print 'PCA calculation complete'
    print pca